# Chapter 2: 基本的数学运算

[TOC]

## 数值微分

### Taylor 展式

$$f(x) = \sum_{i = 0}^{n}\frac{f^{(i)}(x_0)}{i!}(x - x_0)^i + o((x - x_0)^n)$$

### 导数的数值计算

定义 $f_n = f(x_0+nh)$.

- 一阶导数：
  - 两点向前：$$f'(x_0) = \frac{f_1 - f_0}{h} + O(h)$$
  - 两点向后：$$f'(x_0) = \frac{f_0 - f_{-1}}{h} + O(h)$$
  - 三点中心对称：$$f'(x_0) = \frac{f_1 - f_{-1}}{2h} + O(h^2)$$
  - 三点向前：$$f'(x_0) = \frac{-f_2 + 4f_1 - 3f_0}{2h} + O(h^2)$$
  - 三点向后：$$f'(x_0) = \frac{f_{-2} - 4f_{-1} + 3f_0}{2h} + O(h^2)$$
  - 五点中心对称：$$f'(x_0) = \frac{f_{-2} - 8f_{-1} + 8f_1 - f_2}{12h} + O(h^4)$$
- 二阶导数：
  - 三点中心对称：$$f''(x_0) = \frac{f_1 - 2f_0 + f_{-1}}{h^2} + O(h^2)$$
  - 三点向前：$$f''(x_0) = \frac{f_2 - 2f_1 + f_0}{h^2} + O(h^2)$$
  - 三点向后：$$f''(x_0) = \frac{f_0 - 2f_{-1} + f_{-2}}{h^2} + O(h^2)$$

**eg01**

Python 源代码：

```python
import numpy as np


def f_2order(h):
    x = 1
    fm = np.sin(x - h)
    f0 = np.sin(x)
    f1 = np.sin(x + h)

    diff_1_3_c = (f1 - fm) / (2 * h)
    diff_1_2_f = (f1 - f0) / (h)
    diff_1_2_b = (f0 - fm) / (h)
    diff_2_3_c = (f1 - 2 * f0 + fm) / (h ** 2)

    diff_1 = np.cos(x)
    diff_2 = -np.sin(x)

    err1 = diff_1_3_c - diff_1
    err2 = diff_1_2_f - diff_1
    err3 = diff_1_2_b - diff_1
    err4 = diff_2_3_c - diff_2

    return [
        [diff_1_3_c, err1],
        [diff_1_2_f, err2],
        [diff_1_2_b, err3],
        [diff_2_3_c, err4]
    ]


h1 = 1e-2
print(f"h = {h1}:\n{f_2order(h1)}")

h2 = 1e-3
print(f"h = {h2}:\n{f_2order(h2)}")

h3 = 1e-4
print(f"h = {h3}:\n{f_2order(h3)}")

h4 = 1e-5
print(f"h = {h4}:\n{f_2order(h4)}")

h5 = 1e-6
print(f"h = {h5}:\n{f_2order(h5)}")
```

运行结果：

```
h = 0.01:
[[0.5402933008747335, -9.004993406280803e-06], [0.536085981011869, -0.00421632485627077], [0.544500620737598, 0.004198314869458208], [-0.8414639725728978, 7.012234998660105e-06]]
h = 0.001:
[[0.5403022158176896, -9.005045020771263e-08], [0.5398814803603269, -0.0004208255078128609], [0.5407229512750522, 0.00042064540691244545], [-0.8414709147253063, 7.008259017560192e-08]]
h = 0.0001:
[[0.5403023049677103, -9.004295087322589e-10], [0.5402602314186211, -4.207444951864758e-05], [0.5403443785167994, 4.207264865963012e-05], [-0.841470981782777, 3.025119488242467e-09]]
h = 1e-05:
[[0.5403023058569989, -1.1140866007508521e-11], [0.5402980985058647, -4.207362275021609e-06], [0.540306513208133, 4.207339993289594e-06], [-0.8414702268311202, 7.579767763443712e-07]]
h = 1e-06:
[[0.5403023058958567, 2.7716939854371958e-11], [0.5403018851213304, -4.2074680939307996e-07], [0.540302726670383, 4.208022432727887e-07], [-0.8415490526658687, -7.806785797215277e-05]]
```

Julia 源代码：

```Julia
function f_2order(h::Float64)
    x = 1
    fm = sin(x - h)
    f0 = sin(x)
    f1 = sin(x + h)

    diff_1_3_c = (f1 - fm) / (2 * h)
    diff_1_2_f = (f1 - f0) / (h)
    diff_1_2_b = (f0 - fm) / (h)
    diff_2_3_c = (f1 - 2 * f0 + fm) / (h^2)

    diff_1 = cos(x)
    diff_2 = -sin(x)

    err1 = diff_1_3_c - diff_1
    err2 = diff_1_2_f - diff_1
    err3 = diff_1_2_b - diff_1
    err4 = diff_2_3_c - diff_2

    return (
        (diff_1_3_c, err1),
        (diff_1_2_f, err2),
        (diff_1_2_b, err3),
        (diff_2_3_c, err4)
        )
end

h1 = 1e-2
println("h = ", h1, ":\n", f_2order(h1))

h2 = 1e-3
println("h = ", h2, ":\n", f_2order(h2))

h3 = 1e-4
println("h = ", h3, ":\n", f_2order(h3))

h4 = 1e-5
println("h = ", h4, ":\n", f_2order(h4))

h5 = 1e-6
println("h = ", h5, ":\n", f_2order(h5))
```

运行结果：

```
h = 0.01:
((0.5402933008747335, -9.004993406280803e-6), (0.536085981011869, -0.00421632485627077), (0.544500620737598, 0.004198314869458208), (-0.8414639725728978, 7.012234998660105e-6))
h = 0.001:
((0.5403022158176896, -9.005045020771263e-8), (0.5398814803603269, -0.0004208255078128609), (0.5407229512750522, 0.00042064540691244545), (-0.8414709147253063, 7.008259017560192e-8))
h = 0.0001:
((0.5403023049677103, -9.004295087322589e-10), (0.5402602314186211, -4.207444951864758e-5), (0.5403443785167994, 4.207264865963012e-5), (-0.841470981782777, 3.025119488242467e-9))
h = 1.0e-5:
((0.5403023058569989, -1.1140866007508521e-11), (0.5402980985058647, -4.207362275021609e-6), (0.540306513208133, 4.207339993289594e-6), (-0.8414702268311202, 7.579767763443712e-7))
h = 1.0e-6:
((0.5403023058958567, 2.7716939854371958e-11), (0.5403018851213304, -4.2074680939307996e-7), (0.540302726670383, 4.208022432727887e-7), (-0.8415490526658687, -7.806785797215277e-5))
```
